# API 接口清单_v1.1

> 目标：基于架构 v1.1，定义生鲜销售及智能补货系统的核心 API，遵循 RESTful 规范。

---

## 1) 通用规范

查看：[API接口规范](API接口规范.md)

---

## 2) 核心 API 清单

### 2.1 账号与鉴权 (Auth)[开发完成]
| 接口名 | 路径 | 方法 | 描述 | 关联角色 |
| :--- | :--- | :--- | :--- | :--- |
| 用户登录 | `/auth/login` | POST | 统一登录接口 | 所有 |
| 顾客注册 | `/auth/register` | POST | 顾客自助注册 | 游客 |
| 用户登出 | `/auth/logout` | POST | 登出（前端清除 Token） | 所有 |
| 获取当前信息 | `/auth/me` | GET | 获取当前登录用户信息与角色 | 所有 |
| 获取权限列表 | `/auth/permissions` | GET | 获取当前用户角色列表 | 所有 |
| 分配角色 | `/users/{id}/roles` | PUT | 管理员覆盖式分配角色 | 管理员 |
| 更新用户信息 | `/users/{id}` | PATCH | 自助更新信息/管理员重置密码/禁用 | 所有/管理员 |

### 2.2 商品与库存 (Catalog & Inventory)[暂定]
| 接口名 | 路径 | 方法 | 描述 | 关联角色 |
| :--- | :--- | :--- | :--- | :--- |
| 商品列表 | `/products` | GET | 分页查询商品信息 | 所有 |
| 商品详情 | `/products/{id}` | GET | 获取商品详细信息 | 所有 |
| 维护商品 | `/products` | POST/PUT | 新增或修改商品信息 | 店长 |
| 库存快照 | `/inventory/snapshot` | GET | 获取当前库存水位与批次 | 店长/库管 |
| 库存流水 | `/inventory/ledgers` | GET | 查询库存变动记录 | 店长/库管 |

### 2.3 顾客购买链路 (Customer Order)[暂定]
| 接口名 | 路径 | 方法 | 描述 | 关联角色 |
| :--- | :--- | :--- | :--- | :--- |
| 获取购物车 | `/cart` | GET | 获取当前顾客购物车 | 顾客 |
| 更新购物车 | `/cart/items` | POST/PUT | 添加/修改购物车项 | 顾客 |
| 创建订单 | `/orders` | POST | 提交订单（冻结库存） | 顾客 |
| 模拟支付 | `/orders/{id}/pay` | POST | 模拟支付确认 | 顾客 |
| 订单列表 | `/orders` | GET | 查询个人订单历史 | 顾客 |

### 2.4 入库与采购 (Procurement & Inbound)[暂定]
| 接口名 | 路径 | 方法 | 描述 | 关联角色 |
| :--- | :--- | :--- | :--- | :--- |
| 创建入库单 | `/stock-in` | POST | 库管登记到货信息 | 库管 |
| 确认入库 | `/stock-in/{id}/confirm` | POST | 完成入库并增加库存 | 库管 |
| 入库记录 | `/stock-in` | GET | 查询入库历史 | 店长/库管 |

### 2.5 预测与智能补货 (Forecast & Replenishment)[暂定]
| 接口名 | 路径 | 方法 | 描述 | 关联角色 |
| :--- | :--- | :--- | :--- | :--- |
| 触发预测 | `/replenishment/forecast` | POST | 触发 Python 算法生成建议 | 店长 |
| 补货建议列表 | `/replenishment/suggestions` | GET | 查询系统生成的建议单 | 店长/库管 |
| 审批建议 | `/replenishment/suggestions/{id}/approve` | POST | 店长审批（通过/驳回） | 店长 |

### 2.6 预警与处置 (Alerts)[暂定]
| 接口名 | 路径 | 方法 | 描述 | 关联角色 |
| :--- | :--- | :--- | :--- | :--- |
| 活跃预警 | `/alerts/active` | GET | 查询待处理的库存/效期预警 | 店长/库管 |
| 处置预警 | `/alerts/{id}/resolve` | POST | 记录处置动作（如报损） | 库管 |

### 2.7 驾驶舱统计 (Dashboard)[暂定]
| 接口名 | 路径 | 方法 | 描述 | 关联角色 |
| :--- | :--- | :--- | :--- | :--- |
| 销售统计 | `/stats/sales` | GET | 销售金额与趋势统计 | 店长 |
| 损耗统计 | `/stats/waste` | GET | 报损/过期损耗统计 | 店长 |
| 库存周转 | `/stats/inventory` | GET | 库存周转率分析 | 店长 |

---

## 3) 变更说明
1. **删除**：移除了所有 `/sales/pos/*` 相关的收银侧 API。
2. **增强**：`/stats/sales` 现在包含了线上订单的所有统计口径，并由店长统一查阅。
3. **保留**：保留了基础的 `CASHIER` 角色鉴权逻辑，但不提供专属业务接口。
4. **状态更新**：`2.1 账号与鉴权` 模块已开发完毕，接口定义与模块文档对齐；其他模块标记为暂定。
