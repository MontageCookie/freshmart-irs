# Step B1｜账号与角色闭环模块｜前端（管理端）验收清单

## 0) 前置条件
- 后端已启动并可访问（默认 `http://localhost:8080`）
- 前端已配置 `VITE_API_BASE_URL` 指向后端
- 已存在可登录的种子账号（例如 `admin / aaaa1111`，且具备 `ADMIN` 角色）

## 1) 启动检查
- 前端可正常启动并可访问 `/login`
- 执行 `npm --prefix frontend run typecheck` 通过
- 执行 `npm --prefix frontend run build` 通过

## 2) 登录与会话
- `/login`：不输入用户名/密码时，页面提示必填
- `/login`：输入错误用户名/密码时，页面提示失败信息（含 traceId 时应可见）
- `/login`：登录成功后写入 token（localStorage）并进入 `/me`（或跳转到 redirect 指定路径）
- `/login`：已登录（存在 token）访问 `/login` 会重定向到 `/me`
- `/auth/logout`：点击登出后，token 被清理并跳转 `/login`

## 3) 路由鉴权守卫
- 未登录访问 `/me`：跳转 `/login?redirect=/me`
- 未登录访问 `/users`：跳转 `/login?redirect=/users`
- 非 ADMIN 访问 `/users`：提示“无权限访问”并跳回 `/me`
- token 过期/无效（接口返回 40100/40300 或 HTTP 401/403）：自动清理 token 并跳回登录页（保留 redirect）

## 4) /me（自助）
- `/me`：可展示当前用户信息（含 roles/status）
- `/me`：点击刷新可重新拉取并刷新展示
- `/me`：更新资料必须填写 `currentPassword`
  - 更新 username/phone/email 成功后，页面信息刷新且与后端一致
- `/me`：修改密码必须填写 `currentPassword + newPassword`
  - 修改成功后：旧密码无法登录，新密码可登录

## 5) /users（ADMIN）
- `/users`：可加载用户列表（分页展示）
- `/users`：仅支持 `keyword + status` 过滤（不做 sort）
  - keyword 为空时不传 keyword 参数
  - status=ALL 时不传 status 参数
- `/users`：点击“详情”可进入 `/users/:id`
- `/users`：点击“创建用户”可进入 `/users/new`

## 6) /users/new（ADMIN）
- 角色列表可拉取并展示（仅可选 enabled=true 的角色）
- 创建用户必填项校验：
  - username 必填
  - password 必填
  - roleIds 至少一个
- 创建成功后自动跳转到 `/users/:id`

## 7) /users/:id（ADMIN）
- 基本信息更新：
  - username 必填
  - 提交后数据与后端一致
- 管理员重置密码：
  - 仅提交 `newPassword`（无需 currentPassword）
  - 重置成功后：新密码可登录
- 禁用用户：
  - 点击禁用需二次确认
  - 禁用成功后用户 status 显示为 DISABLED
  - 被禁用用户无法登录且不可访问受保护接口
- 分配角色（覆盖式）：
  - roleIds 不能为空
  - 保存后用户 roles 刷新并与后端一致
  - disabled 角色不可勾选（如存在则显示为不可编辑态）

## 8) 错误可见与脱敏
- 任一接口失败时，页面或 Toast 至少有一处展示错误信息（含 traceId 时应可见）
- 开发环境请求日志不输出明文 password/token

