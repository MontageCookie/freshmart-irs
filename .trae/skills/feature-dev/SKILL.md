---
name: feature-dev
description: 基于代码库深度理解和架构导向的引导式功能开发
---

# 功能开发 (Feature Development)

你正在协助开发者实现一个新功能。请遵循系统化的方法：深度理解代码库、识别并询问所有描述不详的细节、设计优雅的架构，然后执行实现。

## 核心原则 (Core Principles)

- **提出澄清性问题**：识别所有模棱两可、边缘情况和描述不详的行为。提出具体、明确的问题，而不是进行假设。在继续实现之前，必须等待用户的回答。在开发早期提出问题（即在理解代码库之后、设计架构之前）。
- **先理解后行动**：首先阅读并理解现有的代码模式。
- **阅读 Agent 识别的文件**：启动 Agent（智能体）时，要求它们返回最重要的文件阅读列表。在 Agent 完成任务后，阅读这些文件以构建详细的上下文，然后再继续。
- **简洁且优雅**：优先考虑可读性强、易于维护且架构稳健的代码。
- **使用 TodoWrite**：在整个过程中全程跟踪进度。

---

## 阶段 1：发现 (Discovery)

**目标**：理解需要构建的内容

初始请求：$ARGUMENTS

**行动**：
1. 创建包含所有阶段的待办事项列表（Todo List）。
2. 如果功能描述不清晰，请询问用户：
   - 他们要解决什么问题？
   - 该功能应该实现什么？
   - 有哪些限制或具体要求？
3. 总结你的理解并向用户确认。

---

## 階段 2：代码库探索 (Codebase Exploration)

**目标**：从宏观和微观层面理解相关的现有代码和模式。

**行动**：
1. 并行启动 2-3 个代码探索 Agent（Code-explorer agents）。每个 Agent 应当：
   - 全面追溯代码，重点获取对抽象、架构和控制流的全面理解。
   - 针对代码库的不同方面（例如：类似功能、高层理解、架构理解、用户体验等）。
   - 提供 5-10 个关键文件的阅读列表。

   **Agent 提示词示例**：
   - "寻找与 [功能] 相似的特性，并全面追溯其实现过程。"
   - "绘制 [功能领域] 的架构和抽象映射图，全面追溯代码。"
   - "分析 [现有功能/领域] 的当前实现，全面追溯代码。"
   - "识别与 [功能] 相关的 UI 模式、测试方法或扩展点。"

2. 当 Agent 返回结果后，请阅读 Agent 识别的所有文件，以构建深度的理解。
3. 提交一份关于发现结果和所发现模式的综合总结。

---

## 阶段 3：澄清问题 (Clarifying Questions)

**目标**：在设计之前填补空白并消除所有歧义。

**关键 (CRITICAL)**：这是最重要的阶段之一。**严禁跳过**。

**行动**：
1. 审查代码库调研结果和原始功能请求。
2. 识别描述不详的方面：边缘情况、错误处理、集成点、范围边界、设计偏好、向后兼容性、性能需求。
3. **将所有问题以清晰、有条理的列表形式呈现给用户。**
4. **在设计架构之前，必须等待用户的回答。**

如果用户说“按你认为最好的来”，请提供你的建议并获得明确的确认。

---

## 阶段 4：架构设计 (Architecture Design)

**目标**：设计多种具有不同权衡（Trade-offs）的实现方案。

**行动**：
1. 并行启动 2-3 个架构 Agent（Code-architect agents），分别侧重于：最小化改动（改动最小，复用最大）、整洁架构（可维护性，优雅抽象）或务实平衡（速度与质量的平衡）。
2. 审查所有方案，并针对此特定任务形成你认为最合适的见解（考虑：小修复还是大功能、紧急程度、复杂度、团队背景）。
3. 向用户展示：每种方案的简要总结、权衡对比、**带理由的推荐方案**以及具体的实现差异。
4. **询问用户偏好哪种方案。**

---

## 阶段 5：实现 (Implementation)

**目标**：构建功能

**未经用户批准严禁开始实现**

**行动**：
1. 等待用户的明确批准。
2. 阅读之前阶段识别的所有相关文件。
3. 按照选定的架构进行实现。
4. 严格遵守代码库命名和编写规范。
5. 编写整洁、文档齐全的代码。
6. 随着进度更新待办事项。

---

## 阶段 6：质量评审 (Quality Review)

**目标**：确保代码简洁、符合 DRY 原则、优雅、易读且功能正确。

**行动**：
1. 并行启动 3 个代码评审 Agent（Code-reviewer agents），分别侧重于：简洁性/DRY/优雅度、Bug/功能正确性、项目规范/抽象。
2. 汇总评审结果，并识别出你建议修复的最高严重级别问题。
3. **向用户展示评审结果，并询问他们的处理意图**（立即修复、稍后修复或按原样继续）。
4. 根据用户的决定处理相关问题。

---

## 阶段 7：总结 (Summary)

**目标**：记录已完成的工作。

**行动**：
1. 将所有待办事项标记为已完成。
2. 总结内容包括：
   - 构建了什么内容。
   - 做出的关键决策。
   - 修改的文件。
   - 建议的后续步骤。

---